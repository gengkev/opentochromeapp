<!DOCTYPE html>
<!--

All of this is going into the progress bar...for now

-->

<script type="text/javascript">

(function(){
  //load all of the libraries, and converter.js, a library for making this code look a lot less un-cluttered
  var scripts=["libs/jsbn.min.js","libs/jszip.min.js","libs/jszipdeflate.min.js","libs/sha256.min.js",
    "libs/sha1.min.js","libs/rsa.min.js","libs/prng4-rng.min.js","libs/base64.min.js","converter.js"];
  scripts.forEach(function(e,i,a){
    var s=document.createElement('script');
    s.type='text/javascript';
    s.async=true;
    s.src=e;
    var x=document.getElementsByTagName('script')[0];
    x.parentNode.insertBefore(s, x);
  });
})();

window.onload=function(){
  window.opener.ready();
  port.postMessage({name:"progress",message:1});
  port.postMessage({name:"update",message:"dataready"});
}
function generateCRX(crmanifest,origin) {
  var owa=convertWebApp(crmanifest,origin);
    port.postMessage({name:"progress",message:2});
  var zipowa=compileZipFile(owa[0],owa[1]);
    port.postMessage({name:"progress",message:3});
  var keys=getRSA(zipowa);
    port.postMessage({name:"progress",message:4});
  var crx=packageCRX(zipowa,keys);
    port.postMessage({name:"progress",message:5});
  return crx;
}
</script>
