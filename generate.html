<!DOCTYPE html>
<script type="text/javascript">
var port=chrome.extension.connect({name:"converter"});

(function(){
  var scripts=["jsbn.min.js","jszip.min.js","jszipdeflate.min.js",
    "sha256.min.js","sha1.min.js","rsa.min.js","prng4-rng.min.js","base64.min.js"];
  scripts.forEach(function(e,i,a){
    var s=document.createElement('script');
    s.type='text/javascript';
    s.async=true;
    s.src=e;
    var x=document.getElementsByTagName('script')[0];
    x.parentNode.insertBefore(s, x);
  });
})();
window.onload=function(){
  port.postMessage({name:"progress",message:1});
  port.postMessage({name:"update",message:"dataready"});
}
function generateCRX(crmanifest,origin) {
  var owa=convertWebApp(crmanifest,origin);
    port.postMessage({name:"progress",message:2});
  var zipowa=compileZipFile(owa[0],owa[1]);
    port.postMessage({name:"progress",message:3});
  var keys=getRSA(zipowa);
    port.postMessage({name:"progress",message:4});
  var crx=packageCRX(zipowa,keys);
    port.postMessage({name:"progress",message:5});
  return crx;
}
</script>
